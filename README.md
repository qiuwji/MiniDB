# MiniDB - 基于LSM Tree的键值嵌入数据库实现

MiniDB 是一个轻量级嵌入式数据库实现，提供基本的键值存储功能。
该项目旨在展示嵌入式数据库的核心工作原理，包括内存表、持久化存储、日志系统等关键组件，
主要是个人用于学习用途。

## 核心功能

- 基本的键值操作：支持 `put`、`get`、`delete` 等操作
- 事务支持：通过 WriteBatch 实现批量操作
- 持久化存储：数据会被持久化到磁盘，重启后可恢复
- 预写日志(WAL)：确保数据操作的安全性
- 版本控制：通过 Manifest 管理不同版本的 SSTable 集合
- 分层存储：采用类似 LSM-Tree 的结构，优化读写性能

## 架构设计

MiniDB 的核心架构包括以下组件：

1. **内存表(MemTable)**：作为写入的第一站，提供快速的插入和查询
2. **预写日志(WAL)**：在数据写入内存表前先写入日志，确保崩溃后可恢复
3. **SSTable**：磁盘上的有序键值对集合，用于持久化存储
4. **版本控制(Version/VersionSet)**：管理不同层级的 SSTable
5. **Manifest**：记录版本变更历史，用于系统恢复

## 核心组件详解

### 1. 预写日志(WAL)

WAL (Write-Ahead Logging) 是保证数据安全的关键组件，所有写入操作在更新内存表之前都会先写入 WAL。

- `WAL` 类：负责日志的写入和恢复
- `LogReader`/`LogWriter`：日志的读写工具
- 支持记录分片和校验和验证，确保数据完整性

### 2. 内存表(MemTable)

内存表是数据写入的第一站，基于有序数据结构实现，提供高效的插入和查询。

- 当内存表大小达到阈值时，会转换为不可变内存表并最终持久化为 SSTable
- 提供迭代器接口，用于遍历内存中的键值对

### 3. SSTable

SSTable (Sorted String Table) 是磁盘上的有序键值对集合，是数据持久化的主要形式。

- `SSTable` 类：负责 SSTable 文件的读写
- `BlockBuilder`：构建 SSTable 中的数据块
- `Footer`：存储 SSTable 的元数据索引和数据索引

### 4. 版本控制

版本控制系统管理不同层级的 SSTable，负责数据的压缩和合并。

- `Version`：表示数据库的一个版本，包含各层级的 SSTable
- `VersionEdit`：记录版本之间的变更
- `Manifest`：持久化存储版本变更历史，用于系统恢复

## 注意事项

- 本项目主要用于学习和演示目的，不建议直接用于生产环境
- 性能优化和错误处理仍有提升空间

## 待办事项

1. **功能验证与 Bug 修复**
    - 设计全面的测试用例，覆盖各种边界情况
    - 验证LSM树结构的正确性，包括Compaction机制
    - 排查并修复现有实现中的潜在bug
    - 增强异常处理机制，提高系统稳定性

2. **并发安全实现**
    - 为MemTable添加读写锁(ReadWriteLock)支持
    - 实现SSTable操作的同步机制
    - 为版本控制模块添加并发访问控制
    - 设计细粒度锁策略，平衡安全性与性能

3. **远程访问支持**
    - 引入NIO网络模型，实现高效网络通信
    - 设计客户端-服务器通信协议
    - 实现基本的网络API接口，支持远程操作
    - 添加网络传输中的数据序列化/反序列化机制
    - 实现权限控制与安全认证

4. **其他优化**
    - 优化Compaction策略，提升系统性能
    - 完善事务隔离级别支持